@using DQQ.Profiles.Skills
@using DQQ.Web.Pages.DQQs.Builds.Components
@inherits SkillPickerPage
<style>
	.skill_index_selected {
		border: 1px solid red;
		
	}

	.position_relative{
		position: relative;
	}
	.skill_select_badge {
		position: absolute;
		right: -6%;
		top: -17%;
	}
</style>

@if (Avaliable)
{
	<DQQResponsive OnBreakPointChanged="BreakPointChanged" />

	<div class="row g-3">
		@if (!IsSmall)
		{
			<div class="col-6">
				<SkillCompare SelectedIndex="SelectedIndex" PickedSkill="PickedSkill" CurrentSkill="ClickedSkillProfile" ChangeSkill="()=>SaveChange()" />
			</div>
		}
		else
		{
			<Drawer Width="75%" Placement="Placement.Left" @bind-IsOpen="@IsOpen" IsBackdrop="true">
				<SkillCompare SelectedIndex="SelectedIndex" PickedSkill="PickedSkill" CurrentSkill="ClickedSkillProfile" ChangeSkill="()=>SaveChange()" />
			</Drawer>
		}
		
		<div class="col-12 col-sm-12 col-md-6">
			<div class="row g-3">
				<div class="col-12">
					<div class="row g-3">
						@if (SelectedDTO?.SupportSkills?.Any() == true)
						{
							@for (var i = 0; i < SelectedDTO.SupportSkills.Count() + 1; i++)
							{
								if (GetSkillSlotAvaliable(i) != true)
								{
									continue;
								}
								var i2 = i;
								var skilNumber = GetClickedSkill(i2);
								var skill = DQQPool.TryGet<SkillProfile, EnumSkillNumber>(skilNumber ?? EnumSkillNumber.NotSpecified);
								<div class="col-6 col-sm-6 col-md-6 col-lg-4">
									<Card @onclick="()=>SkillClick(i2)" class="@CardClass(i2)">
										<BodyTemplate>
											@(skill?.Name ?? "空")
											<Badge Color="@(i2==0?Color.Primary:Color.Warning)" class="skill_select_badge">
												@if (i2 == 0)
												{
													<span>主动</span>
												}
												else
												{
													<span>辅助</span>
												}

											</Badge>
										</BodyTemplate>
									</Card>
								</div>

							}
						}
					</div>
				</div>
				<div class="col-12">
					<Card>
						<BodyTemplate>
							<BootstrapInputGroup>
								@foreach (var t in BindingTypeFilters)
								{
									<Toggle Width="80" @bind-Value="t.Selected" OnText="@t.Value.GetEnumString().Substring(0,2)" OffText="@t.Value.GetEnumString().Substring(0,2)" Color="t.Value.GetColor()" />
								}
							</BootstrapInputGroup>
						</BodyTemplate>
					</Card>
					<Card>
						<BodyTemplate>
							<div class="row g-3">
								@foreach(var skill in AvaliableSkills)
								{
									<div class="col-6 col-sm-6 col-md-6 col-lg-4">
										<Card class="@(PickedSkill==skill?"border-danger":"")" @onclick="()=> SkillPicked(skill)">
											<BodyTemplate>
												@skill.Name
											</BodyTemplate>
										</Card>
									</div>
								}
							</div>
						</BodyTemplate>
					</Card>
				</div>
			</div>
		</div>
		
	</div>
}
